# PRD: 커피 로스팅 로그 기록 시스템

## 1. 개요 (Overview)

### 1.1 목적
커피 로스터가 로스팅 과정을 실시간으로 기록하고, 온도 변화 및 주요 이벤트를 시각화하여 로스팅 프로파일을 관리할 수 있는 웹 기반 애플리케이션

### 1.2 핵심 가치
- 정확한 로스팅 데이터 기록 및 재현성 확보
- 직관적인 시각화를 통한 로스팅 프로세스 모니터링
- 과거 로스팅 데이터 분석을 통한 품질 개선

---

## 2. 기능 요구사항 (Functional Requirements)

### 2.1 로스팅 세션 관리

#### 2.1.1 로스팅 시작
- **트리거**: "로스팅 시작" 버튼 클릭
- **입력 필드**:
  - **필수**:
    - 로스팅 머신 선택 (드롭다운: G60 / P25 / L12)
    - 투입 온도 (°C)
    - 시작 화력 (%, 0-100)
  - **선택사항**:
    - 제품명 (텍스트 입력)
    - 로스터 이름 (텍스트 입력)
    - 투입량 (그램)
- **동작**:
  - 타이머 시작 (00:00부터)
  - 1분 단위 온도 기록 활성화
  - 상태창에 "로스팅 진행 중" 표시

#### 2.1.2 로스팅 종료
- **트리거**: "로스팅 종료" 버튼 클릭
- **입력 필드**:
  - 배출 온도 (°C)
  - 배출 시간 (자동 입력, 수정 가능)
  - 메모 (선택사항: 텍스트 영역, 특이사항 기록)
- **동작**:
  - 타이머 정지
  - 최종 데이터 저장
  - 상태창에 "로스팅 완료" 표시

#### 2.1.3 상태 표시
- **상태 유형**:
  - 대기 중 (Idle)
  - 로스팅 진행 중 (Roasting)
  - 로스팅 완료 (Completed)
- **표시 정보**:
  - 현재 경과 시간
  - 현재 온도
  - 현재 화력

---

### 2.2 온도 및 RoR 기록

#### 2.2.1 온도 기록
- **기록 주기**: 1분 단위
- **최대 기록 시간**: 17분
- **입력 방식**: 
  - 수동 입력 (텍스트 필드)
  - 각 분(00:00 ~ 17:00)마다 온도 입력란 제공

#### 2.2.2 RoR (Rate of Rise) 계산
- **계산 공식**: `RoR = (현재 온도 - 이전 분 온도) / 1분`
- **표시 규칙**:
  - 양수 값만 표시 (마이너스 값은 숨김 또는 "N/A")
  - TP(Turning Point) 이전 값은 표시하지 않음
- **단위**: °C/min

#### 2.2.3 데이터 테이블
| 시간 (분) | 온도 (°C) | RoR (°C/min) | 화력 (%) | 비고 |
|----------|----------|-------------|---------|------|
| 00:00    | 200      | -           | 80      | 투입 |
| 01:00    | 185      | N/A         | 80      |      |
| 02:00    | 175      | N/A         | 80      | TP   |
| 03:00    | 180      | 5.0         | 75      |      |

---

### 2.3 주요 이벤트 기록

#### 2.3.1 이벤트 유형
1. **TP (Turning Point)**: 온도가 최저점에 도달한 후 상승 전환
2. **화력 조절**: 화력 변경 시점
3. **1차 크랙 (First Crack)**: 원두의 첫 번째 팝핑 사운드
4. **2차 크랙 (Second Crack)**: 원두의 두 번째 팝핑 사운드

#### 2.3.2 이벤트 입력 UI
각 이벤트 버튼 클릭 시 입력 폼 표시:

```
[TP 버튼]
  ├─ 발생 시간: [자동 입력] (수정 가능)
  ├─ 온도: [입력 필드] °C
  └─ 화력: [입력 필드] %

[화력조절 버튼]
  ├─ 조절 시간: [자동 입력]
  ├─ 변경 전 화력: [자동 입력]
  └─ 변경 후 화력: [입력 필드] %

[1차 크랙 버튼]
  ├─ 발생 시간: [자동 입력]
  ├─ 온도: [입력 필드] °C
  └─ 화력: [현재 화력 표시]

[2차 크랙 버튼]
  ├─ 발생 시간: [자동 입력]
  ├─ 온도: [입력 필드] °C
  └─ 화력: [현재 화력 표시]
```

---

### 2.4 데이터 시각화

#### 2.4.1 온도 차트
- **차트 유형**: 라인 차트 (Line Chart)
- **X축**: 시간 (분)
- **Y축**: 온도 (°C)
- **데이터 시리즈**:
  - 온도 곡선 (주황색 실선)
  - RoR 곡선 (파란색 점선, 보조 Y축)

#### 2.4.2 이벤트 마커
차트 상에 주요 이벤트 표시:
- **TP**: 녹색 삼각형 마커
- **화력 조절**: 노란색 다이아몬드 마커
- **1차 크랙**: 주황색 원형 마커
- **2차 크랙**: 빨간색 사각형 마커

#### 2.4.3 인터랙션
- 마커 호버 시 상세 정보 툴팁 표시
- 줌/팬 기능 (선택사항)
- 범례 클릭으로 시리즈 토글

---

## 3. 기술 요구사항 (Technical Requirements)

### 3.1 프론트엔드
- **프레임워크**: React.js 또는 Vue.js
- **차트 라이브러리**: Chart.js, Recharts, 또는 Apache ECharts
- **UI 컴포넌트**: 
  - 반응형 디자인 (모바일/태블릿 지원)
  - 다크 모드 지원 (선택사항)

### 3.2 백엔드 & 데이터 저장

> [!IMPORTANT]
> **의논 필요 사항**: 아래 3가지 옵션 중 선택 필요

#### 옵션 1: 로컬 스토리지 (간단한 방식)
- **장점**: 서버 불필요, 빠른 구현
- **단점**: 데이터 공유 불가, 백업 어려움
- **구현**: `localStorage` 또는 `IndexedDB`

#### 옵션 2: 클라우드 기반 (Firebase/Supabase)
- **장점**: 빠른 구축, 인증/DB 통합, 실시간 동기화
- **단점**: 비용 발생 가능, 벤더 종속
- **구현**: 
  - Firebase Firestore (NoSQL)
  - Supabase (PostgreSQL)

#### 옵션 3: 자체 서버 구축
- **장점**: 완전한 제어, 커스터마이징 자유
- **단점**: 인프라 관리 필요, 개발 시간 증가
- **구현**:
  - Backend: Node.js (Express) 또는 Python (FastAPI)
  - Database: PostgreSQL 또는 MongoDB
  - Hosting: AWS, GCP, 또는 Vercel

---

### 3.3 데이터 모델 (예시)

```typescript
interface RoastingSession {
  id: string;
  createdAt: Date;
  
  // 기본 정보
  productName?: string; // 제품명 (기존 beanName에서 변경)
  beanWeight?: number; // 그램
  
  // 로스팅 환경
  roastingMachine: 'G60' | 'P25' | 'L12'; // 로스팅 머신 선택
  roasterName?: string; // 로스터 이름
  
  // 시작/종료 정보
  startTemperature: number;
  startHeatLevel: number;
  endTemperature: number;
  endTime: number; // 분
  
  // 온도 기록
  temperatureLog: TemperatureRecord[];
  
  // 이벤트 기록
  events: RoastingEvent[];
  
  // 메모
  notes?: string; // 메모/특이사항
  
  // 상태
  status: 'idle' | 'roasting' | 'completed';
}

interface TemperatureRecord {
  time: number; // 분 (0-17)
  temperature: number;
  ror?: number; // Rate of Rise
  heatLevel: number;
}

interface RoastingEvent {
  type: 'TP' | 'HEAT_CHANGE' | 'FIRST_CRACK' | 'SECOND_CRACK';
  time: number; // 분
  temperature: number;
  heatLevel: number;
  notes?: string;
}
```

---

## 4. UI/UX 요구사항

### 4.1 레이아웃 구조

```
┌─────────────────────────────────────────────┐
│  [로고] 커피 로스팅 로그 시스템              │
├─────────────────────────────────────────────┤
│  머신: G60 | 로스터: 홍길동 | 제품: 블렌드A │
│  상태: [로스팅 진행 중] 경과시간: 05:23     │
│  현재온도: 185°C | 화력: 75%                │
├─────────────────────────────────────────────┤
│  [로스팅 시작] [로스팅 종료]                │
├─────────────────────────────────────────────┤
│  ┌───────────────────────────────────────┐  │
│  │     온도/RoR 차트 (시각화)            │  │
│  │                                       │  │
│  └───────────────────────────────────────┘  │
├─────────────────────────────────────────────┤
│  주요 이벤트:                               │
│  [TP] [화력조절] [1차 크랙] [2차 크랙]     │
│                                             │
│  [이벤트 입력 폼 - 동적 표시]               │
├─────────────────────────────────────────────┤
│  온도 기록 테이블:                          │
│  시간 | 온도 | RoR | 화력 | 비고           │
│  00:00| 200 | -   | 80  | 투입            │
│  01:00| [입력]| - | 80  |                 │
└─────────────────────────────────────────────┘
```

### 4.2 사용자 플로우

1. **로스팅 시작**
   - "로스팅 시작" 버튼 클릭
   - 투입 온도, 시작 화력 입력
   - 타이머 시작

2. **실시간 기록**
   - 1분마다 온도 입력
   - 주요 이벤트 발생 시 해당 버튼 클릭 → 정보 입력
   - 차트에서 실시간 확인

3. **로스팅 종료**
   - "로스팅 종료" 버튼 클릭
   - 배출 온도 입력
   - 데이터 저장

4. **데이터 조회** (추후 기능)
   - 과거 로스팅 세션 목록
   - 세션별 상세 보기
   - 프로파일 비교

---

## 5. 비기능 요구사항 (Non-Functional Requirements)

### 5.1 성능
- 차트 렌더링: 1초 이내
- 데이터 저장: 2초 이내

### 5.2 사용성
- 모바일 환경에서도 원활한 입력 가능
- 키보드 단축키 지원 (선택사항)

### 5.3 안정성
- 브라우저 새로고침 시 진행 중인 데이터 보존
- 입력 데이터 유효성 검사

---

## 6. 향후 확장 가능성

### 6.1 Phase 2 기능
- [ ] 로스팅 프로파일 템플릿 저장/불러오기
- [ ] 여러 세션 비교 차트
- [ ] PDF/이미지 내보내기
- [ ] 원두별 통계 분석

### 6.2 Phase 3 기능
- [ ] 다중 사용자 지원 (팀 협업)
- [ ] 센서 연동 (자동 온도 기록)
- [ ] 머신러닝 기반 로스팅 추천

---

## 7. 의사결정 필요 사항

> [!WARNING]
> **즉시 결정 필요**

### 7.1 데이터 저장 방식
- [ ] 옵션 1: 로컬 스토리지 (빠른 프로토타입)
- [ ] 옵션 2: Firebase/Supabase (중간 복잡도)
- [ ] 옵션 3: 자체 서버 (완전한 제어)

**추천**: 초기에는 **옵션 1 (로컬 스토리지)**로 시작 → MVP 검증 후 **옵션 2**로 마이그레이션

### 7.2 추가 질문
1. 여러 사용자가 데이터를 공유해야 하나요? (로스터리 팀 환경)
2. 모바일 앱도 필요한가요, 아니면 웹만으로 충분한가요?
3. 로스팅 머신과 자동 연동이 필요한가요? (온도 센서 등)
4. 예산 및 일정 제약이 있나요?

---

## 8. 개발 우선순위

### Phase 1 (MVP - 2주)
1. ✅ 로스팅 시작/종료 기능
2. ✅ 1분 단위 온도 기록 (최대 17분)
3. ✅ RoR 계산 (마이너스 값 숨김)
4. ✅ 주요 이벤트 버튼 (TP, 화력조절, 1차/2차 크랙)
5. ✅ 기본 온도 차트 시각화
6. ✅ 로컬 스토리지 저장

### Phase 2 (개선 - 1주)
1. 이벤트 마커 차트 연동
2. 데이터 테이블 UI 개선
3. 반응형 디자인
4. 데이터 내보내기 (JSON/CSV)

### Phase 3 (확장 - 협의)
1. 클라우드 DB 마이그레이션
2. 과거 세션 조회/비교
3. 고급 분석 기능

---

## 9. 성공 지표 (Success Metrics)

- [ ] 로스팅 세션 완료율 100% (데이터 손실 없음)
- [ ] 차트 로딩 시간 < 1초
- [ ] 사용자 만족도 (실제 로스터 피드백)
- [ ] 데이터 정확성 (수동 기록 대비 오차율 < 1%)

---

## 부록: 참고 자료

### A. 용어 정의
- **TP (Turning Point)**: 투입 후 온도가 가장 낮아진 시점
- **RoR (Rate of Rise)**: 분당 온도 상승률
- **1차 크랙**: 약 196-205°C에서 발생하는 원두 팽창음
- **2차 크랙**: 약 224-230°C에서 발생하는 원두 균열음

### B. 기술 스택 예시
```json
{
  "frontend": {
    "framework": "React 18+",
    "chart": "Recharts",
    "styling": "TailwindCSS",
    "state": "Zustand or Context API"
  },
  "backend": {
    "option1": "localStorage",
    "option2": "Firebase",
    "option3": "Node.js + PostgreSQL"
  }
}
```
